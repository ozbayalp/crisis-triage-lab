# ============================================
# CrisisTriage AI - Backend Environment Variables
# ============================================
# Copy this file to .env and configure for your environment.

# --- Application ---
APP_ENV=development
APP_DEBUG=true
APP_LOG_LEVEL=INFO

# --- Server ---
BACKEND_HOST=0.0.0.0
BACKEND_PORT=8000
BACKEND_WORKERS=1

# --- Transcription Service ---
# "dummy" = placeholder responses (no ML dependencies)
# "whisper" = OpenAI Whisper local inference (requires openai-whisper)
TRANSCRIPTION_BACKEND=dummy

# Whisper settings (only used when TRANSCRIPTION_BACKEND=whisper)
WHISPER_MODEL_NAME=base  # tiny, base, small, medium, large
WHISPER_LANGUAGE=en

# --- Prosody Extraction ---
# "dummy" = placeholder features (no ML dependencies)
# "librosa" = Real extraction using librosa
PROSODY_BACKEND=dummy

# --- Triage Model ---
# "dummy" = keyword-based heuristic (no ML dependencies)
# "neural" = trained neural classifier (requires transformers, torch)
TRIAGE_MODEL_BACKEND=dummy

# Path to trained neural model (only used when TRIAGE_MODEL_BACKEND=neural)
# Extract the model first: cd ml/models/neural_triage_v1 && zip -s 0 best_model.zip --out combined.zip && unzip combined.zip
NEURAL_MODEL_DIR=../ml/models/neural_triage_v1/best_model

# --- Audio Processing ---
# Minimum audio chunk size in bytes before processing (~1 second at 16kHz 16-bit mono = 32000)
AUDIO_CHUNK_MIN_BYTES=32000
# Maximum audio buffer size in bytes (~10 seconds)
AUDIO_BUFFER_MAX_BYTES=320000

# --- Privacy & Data Retention ---
# IMPORTANT: Default settings prioritize privacy. Raw audio is NEVER persisted.
PERSIST_RAW_AUDIO=false
PERSIST_TRANSCRIPTS=false
PERSIST_FEATURES=false
SESSION_TTL_SECONDS=0  # 0 = delete immediately after session

# --- Privacy Controls (Pipeline) ---
STORE_RAW_TRANSCRIPTS=false  # If true, transcripts may be stored
STORE_AUDIO=false            # If true, audio may be stored
STORE_PROSODY_FEATURES=false # If true, prosody features may be stored
ANONYMIZE_LOGS=true          # If true, logs contain minimal identifying info

# --- Explainability ---
ENABLE_EXPLAINABILITY=true   # Include feature attribution in results
LOG_EXPLANATIONS=false       # Log detailed explanations (may contain sensitive info)

# --- Analytics & Metrics ---
ENABLE_ANALYTICS=true                   # Enable analytics API and history recording
STORE_ANALYTICS_TEXT_SNIPPETS=false     # Store truncated text snippets (privacy-sensitive)
ANALYTICS_MAX_EVENTS=10000              # Max events to keep in memory
ANALYTICS_EXAMPLE_SNIPPETS_PER_RISK=3   # Max example snippets per risk level

# --- Redis (session state, optional) ---
REDIS_URL=redis://localhost:6379/0

# --- Security ---
SECRET_KEY=CHANGE-ME-IN-PRODUCTION
ALLOWED_ORIGINS=http://localhost:3000,http://127.0.0.1:3000

# --- Telephony Integration ---
ENABLE_TELEPHONY_INTEGRATION=false
TELEPHONY_PROVIDER=generic
TELEPHONY_AUDIO_SAMPLE_RATE=16000
TELEPHONY_AUDIO_CHANNELS=1
TELEPHONY_AUDIO_FORMAT=pcm16
TELEPHONY_SESSION_MAX_MINUTES=60
TELEPHONY_MAX_CONCURRENT_CALLS=100
MASK_PHONE_NUMBERS=true

# Twilio (optional)
TWILIO_ACCOUNT_SID=
TWILIO_AUTH_TOKEN=

# ============================================
# QUICK START CONFIGURATIONS
# ============================================

# --- Development (no ML, fast startup) ---
# TRANSCRIPTION_BACKEND=dummy
# PROSODY_BACKEND=dummy
# TRIAGE_MODEL_BACKEND=dummy

# --- Full ML Pipeline (requires GPU or patience) ---
# TRANSCRIPTION_BACKEND=whisper
# PROSODY_BACKEND=librosa
# TRIAGE_MODEL_BACKEND=neural
# WHISPER_MODEL_NAME=base
# NEURAL_MODEL_DIR=../ml/models/neural_triage_v1/best_model
